# 08. 環境配置問題修復

## 優先級: HIGH 🟠
## 預估時間: 2-3 小時
## 狀態: ✅ COMPLETED (2025-08-14)

### 背景
發現 `.env` 檔案配置與實際系統狀態不一致，導致應用啟動失敗。需要建立更穩健的配置管理機制。

**2025-08-14 實際狀況：**
- `.env.example` 已存在（325 bytes）
- 有多個 .env 相關檔案（.env, .env.backup, .env.example, .env.save）
- 部分子任務可能已完成

### 子任務清單

#### A. 配置檔案管理 (1小時)
- [ ] 創建 `.env.example` 範本檔案
  - [ ] 包含所有必要的環境變數
  - [ ] 提供預設值和說明
  - [ ] 標示必填和選填項目
  
- [ ] 改進 `core/config.py`
  - [ ] 添加配置驗證邏輯
  - [ ] 提供更好的預設值處理
  - [ ] 添加配置檢查函數
  - [ ] 改進錯誤訊息

#### B. Database Adapter 降級機制 (1小時)
- [ ] 改進自動降級邏輯
  - [ ] 當資料庫模式失敗時自動切換到 JSON
  - [ ] 記錄降級原因到日誌
  - [ ] 顯示警告訊息給用戶
  
- [ ] 添加健康檢查
  - [ ] 實現 `check_database_health()` 方法
  - [ ] 在啟動時執行檢查
  - [ ] 提供手動切換模式的功能

#### C. 啟動腳本改進 (0.5小時)
- [ ] 更新 `run.sh`
  - [ ] 檢查環境變數設置
  - [ ] 驗證依賴安裝
  - [ ] 提供更好的錯誤提示
  
- [ ] 創建配置檢查腳本
  - [ ] `scripts/check_config.py`
  - [ ] 驗證所有配置項
  - [ ] 報告潛在問題

#### D. 文檔更新 (0.5小時)
- [ ] 更新 README.md
  - [ ] 添加環境配置說明
  - [ ] 說明 JSON/Database 模式切換
  - [ ] 常見問題解答
  
- [ ] 更新 CLAUDE.md
  - [ ] 添加配置問題排查步驟
  - [ ] 記錄已知問題和解決方案

### 驗收標準
1. 應用能在任何配置下正常啟動
2. 配置錯誤有清晰的錯誤訊息
3. 自動降級機制運作正常
4. 文檔完整且準確

### 測試場景
```bash
# 場景1: 無 .env 檔案
rm .env
./run.sh  # 應該使用預設值正常啟動

# 場景2: 資料庫不可用
USE_DATABASE=true ./run.sh  # 應該自動降級到 JSON

# 場景3: 配置檢查
python scripts/check_config.py  # 應該報告所有問題

# 場景4: 手動切換模式
python -c "
from core.config import switch_storage_mode
switch_storage_mode('json')  # 或 'database'
"
```

### 預期成果
- 更穩健的應用啟動流程
- 減少配置相關的錯誤
- 更好的開發者體驗
- 清晰的錯誤訊息和恢復機制

### 相關文件
- `.env` - 環境配置檔案
- `core/config.py` - 配置管理模組
- `core/database/adapter.py` - 資料庫適配器
- `web/dependencies.py` - 依賴注入

### 注意事項
1. 保持向後兼容性
2. 不要在程式碼中暴露敏感資訊
3. 確保預設值是安全的
4. 考慮不同部署環境（本地、Render、Docker）