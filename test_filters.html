<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>測試篩選功能</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }
        .search-bar {
            margin: 20px 0;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 4px;
        }
        .search-bar input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .filters {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .filter-group {
            flex: 1;
        }
        .filter-group h3 {
            font-size: 14px;
            margin-bottom: 10px;
        }
        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn:hover {
            background: #f0f0f0;
        }
        .btn.active {
            background: #4A90E2;
            color: white;
            border-color: #4A90E2;
        }
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .item-card {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }
        .item-card h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .item-meta {
            display: flex;
            gap: 10px;
            font-size: 12px;
            color: #666;
        }
        .badge {
            padding: 2px 6px;
            background: #e0e0e0;
            border-radius: 3px;
        }
        .no-results {
            text-align: center;
            padding: 40px;
            color: #999;
            display: none;
        }
        .test-status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .test-pass {
            background: #d4edda;
            color: #155724;
        }
        .test-fail {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>篩選功能測試頁面</h1>
        
        <div id="test-results"></div>
        
        <!-- 搜尋欄 -->
        <div class="search-bar">
            <input type="text" id="search-input" placeholder="搜尋測試項目...">
        </div>
        
        <!-- 篩選按鈕 -->
        <div class="filters">
            <div class="filter-group">
                <h3>類別篩選</h3>
                <div class="filter-buttons">
                    <button class="btn filter-tab active" data-filter-type="category" data-filter-value="">全部</button>
                    <button class="btn filter-tab" data-filter-type="category" data-filter-value="系統性錯誤">系統性錯誤</button>
                    <button class="btn filter-tab" data-filter-type="category" data-filter-value="單一性錯誤">單一性錯誤</button>
                    <button class="btn filter-tab" data-filter-type="category" data-filter-value="可以更好">可以更好</button>
                </div>
            </div>
            
            <div class="filter-group">
                <h3>掌握度篩選</h3>
                <div class="filter-buttons">
                    <button class="btn filter-pill active" data-filter-type="mastery" data-filter-value="">全部</button>
                    <button class="btn filter-pill" data-filter-type="mastery" data-filter-value="low">低 (<30%)</button>
                    <button class="btn filter-pill" data-filter-type="mastery" data-filter-value="medium">中 (30-70%)</button>
                    <button class="btn filter-pill" data-filter-type="mastery" data-filter-value="high">高 (>70%)</button>
                </div>
            </div>
        </div>
        
        <!-- 測試項目 -->
        <div class="items-grid" id="items-container">
            <div class="item-card" data-category="系統性錯誤" data-mastery-level="0.2" data-search-text="時態 tense past">
                <h4>過去式時態</h4>
                <div class="item-meta">
                    <span class="badge">系統性錯誤</span>
                    <span>掌握度: 20%</span>
                </div>
            </div>
            
            <div class="item-card" data-category="單一性錯誤" data-mastery-level="0.5" data-search-text="spelling vocabulary">
                <h4>拼寫錯誤</h4>
                <div class="item-meta">
                    <span class="badge">單一性錯誤</span>
                    <span>掌握度: 50%</span>
                </div>
            </div>
            
            <div class="item-card" data-category="可以更好" data-mastery-level="0.8" data-search-text="expression better improvement">
                <h4>表達改進</h4>
                <div class="item-meta">
                    <span class="badge">可以更好</span>
                    <span>掌握度: 80%</span>
                </div>
            </div>
            
            <div class="item-card" data-category="系統性錯誤" data-mastery-level="0.4" data-search-text="grammar structure">
                <h4>文法結構</h4>
                <div class="item-meta">
                    <span class="badge">系統性錯誤</span>
                    <span>掌握度: 40%</span>
                </div>
            </div>
            
            <div class="item-card" data-category="單一性錯誤" data-mastery-level="0.15" data-search-text="idiom phrase">
                <h4>慣用語</h4>
                <div class="item-meta">
                    <span class="badge">單一性錯誤</span>
                    <span>掌握度: 15%</span>
                </div>
            </div>
        </div>
        
        <!-- 無結果提示 -->
        <div class="no-results" id="no-results">
            <p>沒有找到符合條件的項目</p>
        </div>
    </div>
    
    <script>
        // 測試結果容器
        const testResults = document.getElementById('test-results');
        let testsPassed = 0;
        let totalTests = 0;
        
        function addTestResult(testName, passed, message) {
            totalTests++;
            if (passed) testsPassed++;
            
            const result = document.createElement('div');
            result.className = `test-status ${passed ? 'test-pass' : 'test-fail'}`;
            result.textContent = `${passed ? '✓' : '✗'} ${testName}: ${message}`;
            testResults.appendChild(result);
        }
        
        // 篩選功能實現（複製自原始程式碼）
        let activeFilters = {
            category: '',
            mastery: '',
            search: ''
        };
        
        function applyFilters() {
            const items = document.querySelectorAll('.item-card');
            let hasResults = false;
            let visibleCount = 0;
            
            items.forEach(item => {
                let show = true;
                
                // 檢查類別篩選
                if (activeFilters.category) {
                    show = show && item.dataset.category === activeFilters.category;
                }
                
                // 檢查掌握度篩選
                if (activeFilters.mastery) {
                    const mastery = parseFloat(item.dataset.masteryLevel || 0);
                    if (activeFilters.mastery === 'low') {
                        show = show && mastery < 0.3;
                    } else if (activeFilters.mastery === 'medium') {
                        show = show && mastery >= 0.3 && mastery < 0.7;
                    } else if (activeFilters.mastery === 'high') {
                        show = show && mastery >= 0.7;
                    }
                }
                
                // 檢查搜尋條件
                if (activeFilters.search) {
                    const searchText = item.dataset.searchText || '';
                    show = show && searchText.includes(activeFilters.search);
                }
                
                item.style.display = show ? '' : 'none';
                if (show) {
                    hasResults = true;
                    visibleCount++;
                }
            });
            
            document.getElementById('no-results').style.display = hasResults ? 'none' : 'flex';
            return visibleCount;
        }
        
        // 搜尋功能
        document.getElementById('search-input').addEventListener('input', function(e) {
            activeFilters.search = e.target.value.toLowerCase();
            applyFilters();
        });
        
        // 篩選按鈕功能
        document.querySelectorAll('.filter-tab, .filter-pill').forEach(btn => {
            btn.addEventListener('click', function() {
                const filterType = this.dataset.filterType;
                const filterValue = this.dataset.filterValue;
                
                // 更新按鈕狀態
                document.querySelectorAll(`[data-filter-type="${filterType}"]`).forEach(b => {
                    b.classList.remove('active');
                });
                this.classList.add('active');
                
                // 更新活躍篩選條件
                activeFilters[filterType] = filterValue;
                
                // 應用所有篩選條件
                applyFilters();
            });
        });
        
        // 執行測試
        function runTests() {
            // 測試 1: 初始狀態 - 應該顯示所有項目
            const initialCount = document.querySelectorAll('.item-card:not([style*="display: none"])').length;
            addTestResult('初始狀態', initialCount === 5, `顯示 ${initialCount}/5 個項目`);
            
            // 測試 2: 搜尋功能
            document.getElementById('search-input').value = 'tense';
            document.getElementById('search-input').dispatchEvent(new Event('input'));
            setTimeout(() => {
                const searchCount = document.querySelectorAll('.item-card:not([style*="display: none"])').length;
                addTestResult('搜尋 "tense"', searchCount === 1, `找到 ${searchCount} 個項目`);
                
                // 清除搜尋
                document.getElementById('search-input').value = '';
                document.getElementById('search-input').dispatchEvent(new Event('input'));
                
                // 測試 3: 類別篩選
                document.querySelector('[data-filter-type="category"][data-filter-value="系統性錯誤"]').click();
                setTimeout(() => {
                    const categoryCount = document.querySelectorAll('.item-card:not([style*="display: none"])').length;
                    addTestResult('篩選系統性錯誤', categoryCount === 2, `顯示 ${categoryCount} 個項目`);
                    
                    // 測試 4: 掌握度篩選
                    document.querySelector('[data-filter-type="category"][data-filter-value=""]').click();
                    document.querySelector('[data-filter-type="mastery"][data-filter-value="low"]').click();
                    setTimeout(() => {
                        const masteryCount = document.querySelectorAll('.item-card:not([style*="display: none"])').length;
                        addTestResult('篩選低掌握度', masteryCount === 2, `顯示 ${masteryCount} 個項目`);
                        
                        // 測試 5: 組合篩選
                        document.querySelector('[data-filter-type="category"][data-filter-value="單一性錯誤"]').click();
                        setTimeout(() => {
                            const comboCount = document.querySelectorAll('.item-card:not([style*="display: none"])').length;
                            addTestResult('組合篩選(單一性+低掌握度)', comboCount === 1, `顯示 ${comboCount} 個項目`);
                            
                            // 顯示總結
                            const summary = document.createElement('div');
                            summary.className = `test-status ${testsPassed === totalTests ? 'test-pass' : 'test-fail'}`;
                            summary.style.marginTop = '10px';
                            summary.innerHTML = `<strong>測試結果: ${testsPassed}/${totalTests} 通過</strong>`;
                            testResults.appendChild(summary);
                        }, 100);
                    }, 100);
                }, 100);
            }, 100);
        }
        
        // 頁面載入後執行測試
        window.addEventListener('load', () => {
            setTimeout(runTests, 500);
        });
    </script>
</body>
</html>