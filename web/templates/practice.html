{% extends "base.html" %}
{% block title %}ç¿»è­¯ç·´ç¿’ - Linker{% endblock %}

{% block styles %}
<link rel="stylesheet" href="/static/css/pages/practice.css" />
<link rel="stylesheet" href="/static/css/pages/practice-queue.css" />
<link rel="stylesheet" href="/static/css/design-system/03-components/recommendation-cards.css" />
{% endblock %}

{% block content %}
<div class="practice-container">
    <header class="practice-header">
        <h2>ç¿»è­¯ç·´ç¿’</h2>
        <p class="practice-subtitle">é€éä½‡åˆ—ç®¡ç†ç·´ç¿’é€²åº¦ï¼Œå°ˆæ³¨æ–¼æ¯ä¸€æ¬¡çš„ç¿»è­¯æŒ‘æˆ°ã€‚</p>
    </header>

    <section class="question-queue" id="question-queue">
        <div class="queue-header">
            <h3 class="queue-title">ç·´ç¿’ä½‡åˆ—</h3>
            <div class="queue-controls">
                <span class="queue-count" id="queue-count">0 é¡Œå°±ç·’</span>
                <button class="btn queue-clear-btn" data-variant="ghost" data-size="sm" id="clear-queue-btn" title="æ¸…ç©ºä½‡åˆ—">ğŸ—‘ï¸ æ¸…ç©º</button>
            </div>
        </div>
        <div class="queue-items" id="queue-items">
            <div class="queue-item add-new" id="add-question-btn" role="button" tabindex="0">
                <svg class="add-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                <span>æ–°å¢é¡Œç›®</span>
            </div>
        </div>
    </section>

    <main id="practice-sandbox-container">
        <section class="params-row">
            <div class="param-group">
                <label for="mode-select">æ¨¡å¼</label>
                <select name="mode" id="mode-select">
                    <option value="new">æ–°é¡Œç›®</option>
                    <option value="review">è¤‡ç¿’é¡Œ</option>
                    <option value="pattern">æ–‡æ³•å¥å‹ç·´ç¿’</option>
                </select>
            </div>
            <div class="param-group">
                <label for="length-select">é•·åº¦</label>
                <select name="length" id="length-select">
                    <option value="short">çŸ­å¥</option>
                    <option value="medium" selected>ä¸­å¥</option>
                    <option value="long">é•·å¥</option>
                </select>
            </div>
            <div class="param-group">
                <label for="level-select">é›£åº¦</label>
                <select name="level" id="level-select">
                    <option value="1">Level 1</option>
                    <option value="2" selected>Level 2</option>
                    <option value="3">Level 3</option>
                    <option value="4">Level 4</option>
                    <option value="5">Level 5</option>
                </select>
            </div>
        </section>

        <div id="sandbox-content">
            <!-- æ‰€æœ‰å‹•æ…‹å…§å®¹å°‡ç”± JavaScript æ¸²æŸ“åˆ°é€™è£¡ -->
        </div>
    </main>
</div>

<div class="loading-overlay" id="loading-overlay" data-visible="false">
    <div class="spinner"></div>
</div>

<!-- Modal å·²ç§»é™¤ - ç¾åœ¨ä½¿ç”¨å¾Œç«¯éš¨æ©Ÿé¸æ“‡å¥å‹ -->
{% endblock %}

{% block scripts %}
<script src="/static/js/recommendation-card.js"></script>
<script src="/static/js/practice-queue-persistence.js"></script>
<script type="module" src="/static/js/practice-logic.js"></script>
<script>
    // åˆå§‹åŒ–æ¨è–¦å¡ç‰‡æµ®å‹•çµ„ä»¶
    document.addEventListener('DOMContentLoaded', () => {
        const recommendationCard = new RecommendationCard('practice-recommendations', {
            position: 'bottom-left', // ç·´ç¿’é é¢æ”¾å·¦ä¸‹è§’é¿å…å¹²æ“¾
            size: 'default'
        });
        
        // ç›£è½æ¨è–¦ç·´ç¿’äº‹ä»¶
        document.addEventListener('recommendation-practice', (event) => {
            const { difficulty, mode } = event.detail;
            
            // æ›´æ–°ç·´ç¿’åƒæ•¸
            const levelSelect = document.getElementById('level-select');
            const modeSelect = document.getElementById('mode-select');
            
            if (levelSelect) {
                levelSelect.value = difficulty.toString();
            }
            
            if (modeSelect && mode) {
                modeSelect.value = mode;
            }
            
            // è‡ªå‹•æ·»åŠ ä¸€é¡Œåˆ°ä½‡åˆ—
            const addButton = document.getElementById('add-question-btn');
            if (addButton) {
                addButton.click();
            }
        });
        
        // å°‡æ¨è–¦çµ„ä»¶ä¿å­˜åˆ°å…¨åŸŸä»¥ä¾¿å…¶ä»–è…³æœ¬ä½¿ç”¨
        window.practiceRecommendationCard = recommendationCard;
    });
</script>
{% endblock %}