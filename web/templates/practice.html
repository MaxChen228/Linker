{% extends "base.html" %}
{% block title %}翻譯練習 - Linker{% endblock %}

{% block styles %}
<link rel="stylesheet" href="/static/css/pages/practice.css" />
<link rel="stylesheet" href="/static/css/pages/practice-queue.css" />
<link rel="stylesheet" href="/static/css/design-system/03-components/recommendation-cards.css" />
{% endblock %}

{% block content %}
<div class="practice-container">
    <header class="practice-header">
        <h2>翻譯練習</h2>
        <p class="practice-subtitle">透過佇列管理練習進度，專注於每一次的翻譯挑戰。</p>
    </header>

    <section class="question-queue" id="question-queue">
        <div class="queue-header">
            <h3 class="queue-title">練習佇列</h3>
            <div class="queue-controls">
                <span class="queue-count" id="queue-count">0 題就緒</span>
                <button class="btn queue-clear-btn" data-variant="ghost" data-size="sm" id="clear-queue-btn" title="清空佇列">🗑️ 清空</button>
            </div>
        </div>
        <div class="queue-items" id="queue-items">
            <div class="queue-item add-new" id="add-question-btn" role="button" tabindex="0">
                <svg class="add-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                <span>新增題目</span>
            </div>
        </div>
    </section>

    <main id="practice-sandbox-container">
        <section class="params-row">
            <div class="param-group">
                <label for="mode-select">模式</label>
                <select name="mode" id="mode-select">
                    <option value="new">新題目</option>
                    <option value="review">複習題</option>
                    <option value="pattern">文法句型練習</option>
                </select>
            </div>
            <div class="param-group">
                <label for="length-select">長度</label>
                <select name="length" id="length-select">
                    <option value="short">短句</option>
                    <option value="medium" selected>中句</option>
                    <option value="long">長句</option>
                </select>
            </div>
            <div class="param-group">
                <label for="level-select">難度</label>
                <select name="level" id="level-select">
                    <option value="1">Level 1</option>
                    <option value="2" selected>Level 2</option>
                    <option value="3">Level 3</option>
                    <option value="4">Level 4</option>
                    <option value="5">Level 5</option>
                </select>
            </div>
        </section>

        <div id="sandbox-content">
            <!-- 所有動態內容將由 JavaScript 渲染到這裡 -->
        </div>
    </main>
</div>

<div class="loading-overlay" id="loading-overlay" data-visible="false">
    <div class="spinner"></div>
</div>

<!-- Modal 已移除 - 現在使用後端隨機選擇句型 -->
{% endblock %}

{% block scripts %}
<script src="/static/js/recommendation-card.js"></script>
<script src="/static/js/practice-queue-persistence.js"></script>
<script type="module" src="/static/js/practice-logic.js"></script>
<script>
    // 初始化推薦卡片浮動組件
    document.addEventListener('DOMContentLoaded', () => {
        const recommendationCard = new RecommendationCard('practice-recommendations', {
            position: 'bottom-left', // 練習頁面放左下角避免干擾
            size: 'default'
        });
        
        // 監聽推薦練習事件
        document.addEventListener('recommendation-practice', (event) => {
            const { difficulty, mode } = event.detail;
            
            // 更新練習參數
            const levelSelect = document.getElementById('level-select');
            const modeSelect = document.getElementById('mode-select');
            
            if (levelSelect) {
                levelSelect.value = difficulty.toString();
            }
            
            if (modeSelect && mode) {
                modeSelect.value = mode;
            }
            
            // 自動添加一題到佇列
            const addButton = document.getElementById('add-question-btn');
            if (addButton) {
                addButton.click();
            }
        });
        
        // 將推薦組件保存到全域以便其他腳本使用
        window.practiceRecommendationCard = recommendationCard;
    });
</script>
{% endblock %}