{% extends "base.html" %}
{% block title %}è¨­å®š - Linker{% endblock %}

{% block styles %}
<link rel="stylesheet" href="/static/css/pages/settings.css" />
{% endblock %}

{% block content %}
<div class="settings-container">
    <header class="settings-header">
        <h2>ç³»çµ±è¨­å®š</h2>
        <p class="settings-subtitle">èª¿æ•´å­¸ç¿’åå¥½å’Œç³»çµ±è¡Œç‚º</p>
    </header>

    <!-- æ¯æ—¥çŸ¥è­˜é»é™é¡è¨­å®š -->
    <section class="setting-section" id="daily-limit">
        <div class="section-header">
            <h3>
                <span class="section-icon">ğŸ“Š</span>
                æ¯æ—¥çŸ¥è­˜é»é™é¡
            </h3>
            <p class="section-description">
                æ§åˆ¶æ¯æ—¥æ–°å¢çš„ã€Œå–®ä¸€çŸ¥è­˜é»ã€å’Œã€Œå¯ä»¥æ›´å¥½ã€é¡å‹çŸ¥è­˜é»æ•¸é‡ï¼Œå¹³è¡¡å­¸ç¿’é€²åº¦èˆ‡è¤‡ç¿’æ•ˆç‡
            </p>
        </div>

        <div class="setting-content">
            <!-- å•Ÿç”¨ç‹€æ…‹åˆ‡æ› -->
            <div class="setting-item">
                <div class="setting-label">
                    <label for="limit-enabled">å•Ÿç”¨æ¯æ—¥é™é¡</label>
                    <small class="setting-help">é–‹å•Ÿå¾Œç³»çµ±å°‡é™åˆ¶æ¯æ—¥æ–°å¢çš„çŸ¥è­˜é»æ•¸é‡</small>
                </div>
                <div class="setting-control">
                    <label class="switch">
                        <input type="checkbox" id="limit-enabled" {% if daily_limit_config.limit_enabled %}checked{% endif %}>
                        <span class="switch-slider"></span>
                    </label>
                </div>
            </div>

            <!-- é™é¡æ•¸é‡è¨­å®š -->
            <div class="setting-item" id="limit-amount-setting">
                <div class="setting-label">
                    <label for="daily-limit-range">æ¯æ—¥é™é¡æ•¸é‡</label>
                    <small class="setting-help">å»ºè­°è¨­å®šç‚º5-20ä¹‹é–“ï¼Œå¯æ ¹æ“šå€‹äººå­¸ç¿’èƒ½åŠ›èª¿æ•´</small>
                </div>
                <div class="setting-control limit-control">
                    <input 
                        type="range" 
                        id="daily-limit-range" 
                        min="1" 
                        max="50" 
                        value="{{ daily_limit_config.daily_limit }}"
                        class="limit-range"
                    >
                    <input 
                        type="number" 
                        id="daily-limit-number" 
                        min="1" 
                        max="50" 
                        value="{{ daily_limit_config.daily_limit }}"
                        class="limit-number"
                    >
                    <span class="limit-unit">å€‹/å¤©</span>
                </div>
            </div>

            <!-- ç•¶å‰ç‹€æ…‹é¡¯ç¤º -->
            <div class="current-status" id="current-status">
                <div class="status-indicator">
                    <span class="status-icon" id="status-icon">â³</span>
                    <span class="status-text" id="status-text">è¼‰å…¥ä¸­...</span>
                </div>
                <div class="status-progress" id="status-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <small class="progress-info" id="progress-info">è¼‰å…¥ä¸­...</small>
                </div>
            </div>

            <!-- æ“ä½œæŒ‰éˆ• -->
            <div class="setting-actions">
                <button class="btn" data-variant="primary" id="save-settings" disabled>
                    <span id="save-btn-text">å„²å­˜è¨­å®š</span>
                </button>
                <button class="btn" data-variant="ghost" id="reset-daily-count">
                    é‡ç½®ä»Šæ—¥è¨ˆæ•¸
                </button>
                <button class="btn" data-variant="outline" onclick="window.location.href='/practice'">
                    è¿”å›ç·´ç¿’
                </button>
            </div>
        </div>
    </section>

    <!-- ä½¿ç”¨çµ±è¨ˆ -->
    <section class="setting-section" id="usage-stats">
        <div class="section-header">
            <h3>
                <span class="section-icon">ğŸ“ˆ</span>
                ä½¿ç”¨çµ±è¨ˆ
            </h3>
            <p class="section-description">æŸ¥çœ‹æœ€è¿‘çš„çŸ¥è­˜é»æ–°å¢æƒ…æ³</p>
        </div>

        <div class="setting-content">
            <!-- çµ±è¨ˆæ‘˜è¦ -->
            <div class="stats-summary">
                <div class="stat-card">
                    <div class="stat-number">{{ daily_stats.summary.total_usage }}</div>
                    <div class="stat-label">{{ daily_stats.summary.days_queried }}æ—¥ç¸½è¨ˆ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ daily_stats.summary.avg_daily_usage }}</div>
                    <div class="stat-label">å¹³å‡æ¯æ—¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ daily_stats.summary.current_limit }}</div>
                    <div class="stat-label">ç•¶å‰ä¸Šé™</div>
                </div>
            </div>

            <!-- æ¯æ—¥çµ±è¨ˆåœ–è¡¨ -->
            <div class="stats-chart">
                <h4>æœ€è¿‘7å¤©ä½¿ç”¨æƒ…æ³</h4>
                <div class="chart-container" id="daily-chart">
                    {% for stat in daily_stats.stats %}
                    <div class="chart-bar">
                        <div class="bar-container">
                            <div class="bar isolated" style="height: {{ (stat.isolated_count / daily_stats.summary.current_limit * 100)|int }}%"></div>
                            <div class="bar enhancement" style="height: {{ (stat.enhancement_count / daily_stats.summary.current_limit * 100)|int }}%"></div>
                        </div>
                        <div class="bar-label">
                            <div class="bar-date">{{ stat.date[-5:] }}</div>
                            <div class="bar-count">{{ stat.total_count }}</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="chart-legend">
                    <div class="legend-item">
                        <span class="legend-color isolated"></span>
                        <span>å–®ä¸€çŸ¥è­˜é»</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color enhancement"></span>
                        <span>å¯ä»¥æ›´å¥½</span>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- è¼‰å…¥ä¸­è¦†è“‹å±¤ -->
<div class="loading-overlay" id="settings-loading" data-visible="false">
    <div class="spinner"></div>
    <p>æ›´æ–°è¨­å®šä¸­...</p>
</div>
{% endblock %}

{% block scripts %}
<script type="module" src="/static/js/settings.js"></script>
{% endblock %}