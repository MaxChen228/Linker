{% extends "base.html" %}
{% block title %}設定 - Linker{% endblock %}

{% block styles %}
<link rel="stylesheet" href="/static/css/design-system/03-components/progress-indicators.css" />
<link rel="stylesheet" href="/static/css/components/daily-goal-widget.css" />
<link rel="stylesheet" href="/static/css/pages/settings.css" />
{% endblock %}

{% block content %}
<div class="settings-container simplified">
    <header class="settings-header">
        <h2>每日目標設定</h2>
        <p class="settings-subtitle">調整每日新增知識點的目標數量</p>
    </header>

    <!-- 每日目標設定區域 -->
    <section class="setting-section simplified" id="daily-goal-section">
        <div class="daily-goal-container">
            <!-- 使用 DailyGoalWidget 組件 -->
            <div id="daily-goal-widget" class="daily-goal-widget detailed"></div>
        </div>
    </section>

    <!-- 簡化的導航區域 -->
    <section class="navigation-section">
        <div class="nav-actions">
            <a href="/" class="btn" data-variant="primary">
                <span>返回主頁</span>
            </a>
            <a href="/practice" class="btn" data-variant="outline">
                <span>開始練習</span>
            </a>
        </div>
    </section>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/daily-goal-widget.js"></script>
<script>
    // 初始化每日目標組件
    document.addEventListener('DOMContentLoaded', () => {
        // 等待 API endpoints 初始化完成
        function initializeDailyGoal() {
            if (!window.apiEndpoints) {
                console.log('等待 API endpoints 初始化...');
                setTimeout(initializeDailyGoal, 100);
                return;
            }
            
            console.log('API endpoints 已可用，初始化每日目標組件...');
            
            const dailyGoalWidget = new DailyGoalWidget('daily-goal-widget', {
                mode: 'detailed',
                autoRefresh: true,
                refreshInterval: 60000, // 1分鐘自動刷新
                showInput: true
            });
            
            // 將組件實例保存到全域
            window.settingsDailyGoal = dailyGoalWidget;
        }
        
        // 開始初始化
        initializeDailyGoal();
        
        // 監聽目標更新事件
        document.addEventListener('goalUpdated', (event) => {
            const { newLimit } = event.detail;
            
            // 顯示成功訊息
            console.log(`每日目標已更新為: ${newLimit}`);
        });
    });
</script>
{% endblock %}